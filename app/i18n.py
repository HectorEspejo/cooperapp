SUPPORTED_LANGUAGES = ("es", "fr", "en")

TRANSLATIONS = {
    "es": {
        # Login
        "login.title": "Acceso Contraparte - CooperApp",
        "login.subtitle": "Portal de Contraparte",
        "login.error_empty": "Introduce un codigo de proyecto.",
        "login.error_invalid": "Codigo de proyecto no valido o el proyecto no esta en ejecucion.",
        "login.code_label": "Codigo de Proyecto",
        "login.code_placeholder": "Ej: PRY-2024-001",
        "login.code_help": "Introduce el codigo contable del proyecto para acceder.",
        "login.submit": "Acceder al Portal",
        "login.or": "o",
        "login.internal_access": "Acceso interno (Microsoft)",
        "login.language": "Idioma",
        # Portal / navbar
        "portal.counterpart": "Contraparte",
        "portal.logout": "Cerrar sesion",
        "portal.marco_logico": "Marco Logico",
        "portal.documentos": "Documentos",
        "portal.loading": "Cargando...",
        # Timer
        "timer.hours_remaining": "restantes",
        "timer.expired": "Sesion expirada",
        # Marco Logico - tab
        "ml.general_objective": "Objetivo General",
        "ml.save": "Guardar",
        "ml.general_objective_indicators": "Indicadores del Objetivo General",
        "ml.add_indicator": "+ Indicador",
        "ml.framework_structure": "Estructura del Marco Logico",
        "ml.add_specific_objective": "+ Objetivo Especifico",
        "ml.describe_general_objective": "Describa el objetivo general del proyecto...",
        # Marco Logico - summary
        "ml.objectives": "Objetivos",
        "ml.results": "Resultados",
        "ml.activities": "Actividades",
        "ml.indicators": "Indicadores",
        "ml.average_progress": "Avance Medio",
        "ml.completed": "Completadas",
        "ml.in_progress": "En curso",
        "ml.pending": "Pendientes",
        # Marco Logico - tree
        "ml.no_objectives": "No hay objetivos especificos definidos.",
        "ml.click_add_objective": "Haga clic en \"+ Objetivo Especifico\" para comenzar.",
        "ml.add_result": "Anadir Resultado",
        "ml.add_indicator_title": "Anadir Indicador",
        "ml.edit_objective": "Editar Objetivo",
        "ml.delete": "Eliminar",
        "ml.confirm_delete_objective": "Eliminar este objetivo y todos sus elementos?",
        # Marco Logico - result
        "ml.add_activity": "Anadir Actividad",
        "ml.edit_result": "Editar Resultado",
        "ml.confirm_delete_result": "Eliminar este resultado y todas sus actividades?",
        # Marco Logico - activity
        "ml.verification_sources": "Fuentes de verificacion",
        "ml.no_sources": "sin fuentes",
        "ml.edit_activity": "Editar Actividad",
        "ml.confirm_delete_activity": "Eliminar esta actividad?",
        "ml.planned_dates": "Fechas previstas",
        "ml.actual_dates": "Fechas reales",
        # Marco Logico - indicator
        "ml.update_value": "Actualizar valor",
        "ml.edit_indicator": "Editar indicador",
        "ml.view_history": "Ver historial",
        "ml.confirm_delete_indicator": "Eliminar este indicador?",
        "ml.base": "Base",
        "ml.target": "Meta",
        "ml.current": "Actual",
        "ml.unit": "Unidad de medida",
        "ml.verification_source": "Fuente de verificacion",
        # Documents - tab
        "docs.total": "Total",
        "docs.sealed": "Sellados",
        "docs.pending": "Pendientes",
        "docs.linked": "Vinculados",
        "docs.unlinked": "Sin vincular",
        "docs.total_size": "Tamano total:",
        "docs.drag_files": "Arrastra archivos aqui o haz clic para seleccionar",
        "docs.category": "Categoria",
        "docs.description_optional": "Descripcion (opcional)",
        "docs.description_placeholder": "Descripcion del documento...",
        "docs.upload": "Subir documento",
        "docs.all_categories": "Todas las categorias",
        "docs.all_statuses": "Todos los estados",
        "docs.sealed_filter": "Sellados",
        "docs.unsealed_filter": "Sin sellar",
        "docs.all": "Todos",
        "docs.linked_filter": "Vinculados",
        "docs.unlinked_filter": "Sin vincular",
        "docs.download_zip_title": "Descargar todos como ZIP",
        "docs.download_zip": "Descargar ZIP",
        # Documents - table
        "docs.col_preview": "Vista",
        "docs.col_document": "Documento",
        "docs.col_size": "Tamano",
        "docs.col_date": "Fecha",
        "docs.col_status": "Estado",
        "docs.col_linked": "Vinculado",
        "docs.col_actions": "Acciones",
        "docs.status_sealed": "Sellado",
        "docs.status_pending": "Pendiente",
        "docs.status_unlinked": "Sin vincular",
        "docs.verification_sources_count": "fuente(s) de verificacion",
        "docs.download": "Descargar",
        "docs.preview_action": "Previsualizar",
        "docs.seal_document": "Sellar documento",
        "docs.confirm_seal": "Sellar este documento? Esta accion no se puede deshacer.",
        "docs.confirm_delete": "Eliminar este documento?",
        "docs.no_documents": "No hay documentos",
        "docs.upload_first": "Sube el primer documento usando el formulario de arriba.",
        # Documents - preview modal
        "docs.preview_unavailable": "Vista previa no disponible para este tipo de archivo.",
        "docs.download_file": "Descargar archivo",
        "docs.info_category": "Categoria:",
        "docs.info_size": "Tamano:",
        "docs.info_uploaded": "Subido:",
        "docs.info_sealed": "Sellado:",
        "docs.yes": "Si",
        "docs.close": "Cerrar",
    },
    "fr": {
        # Login
        "login.title": "Acces Contrepartie - CooperApp",
        "login.subtitle": "Portail de la Contrepartie",
        "login.error_empty": "Veuillez saisir un code de projet.",
        "login.error_invalid": "Code de projet invalide ou le projet n'est pas en cours d'execution.",
        "login.code_label": "Code du Projet",
        "login.code_placeholder": "Ex: PRY-2024-001",
        "login.code_help": "Saisissez le code comptable du projet pour acceder.",
        "login.submit": "Acceder au Portail",
        "login.or": "ou",
        "login.internal_access": "Acces interne (Microsoft)",
        "login.language": "Langue",
        # Portal / navbar
        "portal.counterpart": "Contrepartie",
        "portal.logout": "Deconnexion",
        "portal.marco_logico": "Cadre Logique",
        "portal.documentos": "Documents",
        "portal.loading": "Chargement...",
        # Timer
        "timer.hours_remaining": "restantes",
        "timer.expired": "Session expiree",
        # Marco Logico - tab
        "ml.general_objective": "Objectif General",
        "ml.save": "Enregistrer",
        "ml.general_objective_indicators": "Indicateurs de l'Objectif General",
        "ml.add_indicator": "+ Indicateur",
        "ml.framework_structure": "Structure du Cadre Logique",
        "ml.add_specific_objective": "+ Objectif Specifique",
        "ml.describe_general_objective": "Decrivez l'objectif general du projet...",
        # Marco Logico - summary
        "ml.objectives": "Objectifs",
        "ml.results": "Resultats",
        "ml.activities": "Activites",
        "ml.indicators": "Indicateurs",
        "ml.average_progress": "Avancement Moyen",
        "ml.completed": "Completees",
        "ml.in_progress": "En cours",
        "ml.pending": "En attente",
        # Marco Logico - tree
        "ml.no_objectives": "Aucun objectif specifique defini.",
        "ml.click_add_objective": "Cliquez sur \"+ Objectif Specifique\" pour commencer.",
        "ml.add_result": "Ajouter Resultat",
        "ml.add_indicator_title": "Ajouter Indicateur",
        "ml.edit_objective": "Modifier l'Objectif",
        "ml.delete": "Supprimer",
        "ml.confirm_delete_objective": "Supprimer cet objectif et tous ses elements?",
        # Marco Logico - result
        "ml.add_activity": "Ajouter Activite",
        "ml.edit_result": "Modifier le Resultat",
        "ml.confirm_delete_result": "Supprimer ce resultat et toutes ses activites?",
        # Marco Logico - activity
        "ml.verification_sources": "Sources de verification",
        "ml.no_sources": "sans sources",
        "ml.edit_activity": "Modifier l'Activite",
        "ml.confirm_delete_activity": "Supprimer cette activite?",
        "ml.planned_dates": "Dates prevues",
        "ml.actual_dates": "Dates reelles",
        # Marco Logico - indicator
        "ml.update_value": "Mettre a jour la valeur",
        "ml.edit_indicator": "Modifier l'indicateur",
        "ml.view_history": "Voir l'historique",
        "ml.confirm_delete_indicator": "Supprimer cet indicateur?",
        "ml.base": "Base",
        "ml.target": "Cible",
        "ml.current": "Actuel",
        "ml.unit": "Unite de mesure",
        "ml.verification_source": "Source de verification",
        # Documents - tab
        "docs.total": "Total",
        "docs.sealed": "Scelles",
        "docs.pending": "En attente",
        "docs.linked": "Lies",
        "docs.unlinked": "Non lies",
        "docs.total_size": "Taille totale:",
        "docs.drag_files": "Glissez des fichiers ici ou cliquez pour selectionner",
        "docs.category": "Categorie",
        "docs.description_optional": "Description (facultatif)",
        "docs.description_placeholder": "Description du document...",
        "docs.upload": "Telecharger le document",
        "docs.all_categories": "Toutes les categories",
        "docs.all_statuses": "Tous les etats",
        "docs.sealed_filter": "Scelles",
        "docs.unsealed_filter": "Non scelles",
        "docs.all": "Tous",
        "docs.linked_filter": "Lies",
        "docs.unlinked_filter": "Non lies",
        "docs.download_zip_title": "Telecharger tout en ZIP",
        "docs.download_zip": "Telecharger ZIP",
        # Documents - table
        "docs.col_preview": "Apercu",
        "docs.col_document": "Document",
        "docs.col_size": "Taille",
        "docs.col_date": "Date",
        "docs.col_status": "Etat",
        "docs.col_linked": "Lie",
        "docs.col_actions": "Actions",
        "docs.status_sealed": "Scelle",
        "docs.status_pending": "En attente",
        "docs.status_unlinked": "Non lie",
        "docs.verification_sources_count": "source(s) de verification",
        "docs.download": "Telecharger",
        "docs.preview_action": "Previsualiser",
        "docs.seal_document": "Sceller le document",
        "docs.confirm_seal": "Sceller ce document? Cette action est irreversible.",
        "docs.confirm_delete": "Supprimer ce document?",
        "docs.no_documents": "Aucun document",
        "docs.upload_first": "Telechargez le premier document en utilisant le formulaire ci-dessus.",
        # Documents - preview modal
        "docs.preview_unavailable": "Apercu non disponible pour ce type de fichier.",
        "docs.download_file": "Telecharger le fichier",
        "docs.info_category": "Categorie:",
        "docs.info_size": "Taille:",
        "docs.info_uploaded": "Telecharge:",
        "docs.info_sealed": "Scelle:",
        "docs.yes": "Oui",
        "docs.close": "Fermer",
    },
    "en": {
        # Login
        "login.title": "Counterpart Access - CooperApp",
        "login.subtitle": "Counterpart Portal",
        "login.error_empty": "Please enter a project code.",
        "login.error_invalid": "Invalid project code or the project is not in execution.",
        "login.code_label": "Project Code",
        "login.code_placeholder": "E.g.: PRY-2024-001",
        "login.code_help": "Enter the project accounting code to access.",
        "login.submit": "Access Portal",
        "login.or": "or",
        "login.internal_access": "Internal access (Microsoft)",
        "login.language": "Language",
        # Portal / navbar
        "portal.counterpart": "Counterpart",
        "portal.logout": "Log out",
        "portal.marco_logico": "Logical Framework",
        "portal.documentos": "Documents",
        "portal.loading": "Loading...",
        # Timer
        "timer.hours_remaining": "remaining",
        "timer.expired": "Session expired",
        # Marco Logico - tab
        "ml.general_objective": "General Objective",
        "ml.save": "Save",
        "ml.general_objective_indicators": "General Objective Indicators",
        "ml.add_indicator": "+ Indicator",
        "ml.framework_structure": "Logical Framework Structure",
        "ml.add_specific_objective": "+ Specific Objective",
        "ml.describe_general_objective": "Describe the general objective of the project...",
        # Marco Logico - summary
        "ml.objectives": "Objectives",
        "ml.results": "Results",
        "ml.activities": "Activities",
        "ml.indicators": "Indicators",
        "ml.average_progress": "Average Progress",
        "ml.completed": "Completed",
        "ml.in_progress": "In progress",
        "ml.pending": "Pending",
        # Marco Logico - tree
        "ml.no_objectives": "No specific objectives defined.",
        "ml.click_add_objective": "Click \"+ Specific Objective\" to begin.",
        "ml.add_result": "Add Result",
        "ml.add_indicator_title": "Add Indicator",
        "ml.edit_objective": "Edit Objective",
        "ml.delete": "Delete",
        "ml.confirm_delete_objective": "Delete this objective and all its elements?",
        # Marco Logico - result
        "ml.add_activity": "Add Activity",
        "ml.edit_result": "Edit Result",
        "ml.confirm_delete_result": "Delete this result and all its activities?",
        # Marco Logico - activity
        "ml.verification_sources": "Verification sources",
        "ml.no_sources": "no sources",
        "ml.edit_activity": "Edit Activity",
        "ml.confirm_delete_activity": "Delete this activity?",
        "ml.planned_dates": "Planned dates",
        "ml.actual_dates": "Actual dates",
        # Marco Logico - indicator
        "ml.update_value": "Update value",
        "ml.edit_indicator": "Edit indicator",
        "ml.view_history": "View history",
        "ml.confirm_delete_indicator": "Delete this indicator?",
        "ml.base": "Baseline",
        "ml.target": "Target",
        "ml.current": "Current",
        "ml.unit": "Unit of measurement",
        "ml.verification_source": "Verification source",
        # Documents - tab
        "docs.total": "Total",
        "docs.sealed": "Sealed",
        "docs.pending": "Pending",
        "docs.linked": "Linked",
        "docs.unlinked": "Unlinked",
        "docs.total_size": "Total size:",
        "docs.drag_files": "Drag files here or click to select",
        "docs.category": "Category",
        "docs.description_optional": "Description (optional)",
        "docs.description_placeholder": "Document description...",
        "docs.upload": "Upload document",
        "docs.all_categories": "All categories",
        "docs.all_statuses": "All statuses",
        "docs.sealed_filter": "Sealed",
        "docs.unsealed_filter": "Unsealed",
        "docs.all": "All",
        "docs.linked_filter": "Linked",
        "docs.unlinked_filter": "Unlinked",
        "docs.download_zip_title": "Download all as ZIP",
        "docs.download_zip": "Download ZIP",
        # Documents - table
        "docs.col_preview": "Preview",
        "docs.col_document": "Document",
        "docs.col_size": "Size",
        "docs.col_date": "Date",
        "docs.col_status": "Status",
        "docs.col_linked": "Linked",
        "docs.col_actions": "Actions",
        "docs.status_sealed": "Sealed",
        "docs.status_pending": "Pending",
        "docs.status_unlinked": "Unlinked",
        "docs.verification_sources_count": "verification source(s)",
        "docs.download": "Download",
        "docs.preview_action": "Preview",
        "docs.seal_document": "Seal document",
        "docs.confirm_seal": "Seal this document? This action cannot be undone.",
        "docs.confirm_delete": "Delete this document?",
        "docs.no_documents": "No documents",
        "docs.upload_first": "Upload the first document using the form above.",
        # Documents - preview modal
        "docs.preview_unavailable": "Preview not available for this file type.",
        "docs.download_file": "Download file",
        "docs.info_category": "Category:",
        "docs.info_size": "Size:",
        "docs.info_uploaded": "Uploaded:",
        "docs.info_sealed": "Sealed:",
        "docs.yes": "Yes",
        "docs.close": "Close",
    },
}


def detect_language(accept_language_header: str | None) -> str:
    if not accept_language_header:
        return "es"
    for part in accept_language_header.split(","):
        lang = part.split(";")[0].strip().lower()
        # Match exact or prefix (e.g. "fr-FR" -> "fr")
        if lang in SUPPORTED_LANGUAGES:
            return lang
        prefix = lang.split("-")[0]
        if prefix in SUPPORTED_LANGUAGES:
            return prefix
    return "es"


def get_translator(lang: str):
    translations = TRANSLATIONS.get(lang, TRANSLATIONS["es"])
    fallback = TRANSLATIONS["es"]

    def t(key: str) -> str:
        return translations.get(key, fallback.get(key, key))

    return t
