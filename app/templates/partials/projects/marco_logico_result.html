{% set _t = t if t is defined else None %}
{% set _counterpart = is_counterpart if is_counterpart is defined else false %}
<div class="ml-tree-node ml-result" data-result-id="{{ result.id }}">
    <div class="ml-node-header">
        <button class="ml-toggle" onclick="toggleNode(this)">
            <i data-lucide="chevron-down" class="toggle-icon"></i>
        </button>
        <span class="ml-node-label ml-result-label">{{ result.numero }}</span>
        <span class="ml-node-text">{{ tc('result', result.id, 'descripcion', result.descripcion) if tc is defined else result.descripcion }}</span>
        {% if not _counterpart %}
        <div class="ml-node-actions">
            <button
                class="btn btn-icon"
                title="{{ _t('ml.add_activity') if _t else 'Anadir Actividad' }}"
                hx-get="/projects/{{ project.id }}/marco-logico/activity-form?result_id={{ result.id }}"
                hx-target="#indicator-modal-container"
                hx-swap="innerHTML"
                onclick="document.getElementById('indicator-modal-container').classList.add('active')"
            >+A</button>
            <button
                class="btn btn-icon"
                title="{{ _t('ml.add_indicator_title') if _t else 'Anadir Indicador' }}"
                hx-get="/projects/{{ project.id }}/marco-logico/indicator-form?framework_id={{ framework.id }}&result_id={{ result.id }}"
                hx-target="#indicator-modal-container"
                hx-swap="innerHTML"
                onclick="document.getElementById('indicator-modal-container').classList.add('active')"
            >+I</button>
            <button
                class="btn btn-icon"
                title="{{ _t('ml.edit_result') if _t else 'Editar Resultado' }}"
                hx-get="/projects/{{ project.id }}/marco-logico/result-form?result_id={{ result.id }}"
                hx-target="#indicator-modal-container"
                hx-swap="innerHTML"
                onclick="document.getElementById('indicator-modal-container').classList.add('active')"
            ><i data-lucide="pencil"></i></button>
            <button
                class="btn btn-icon btn-danger"
                title="{{ _t('ml.delete') if _t else 'Eliminar' }}"
                hx-delete="/projects/results/{{ result.id }}"
                hx-target="#marco-logico-content"
                hx-swap="innerHTML"
                hx-confirm="{{ _t('ml.confirm_delete_result') if _t else 'Eliminar este resultado y todas sus actividades?' }}"
            ><i data-lucide="x"></i></button>
        </div>
        {% endif %}
    </div>

    <!-- Result Indicators -->
    {% if result.indicators %}
    <div class="ml-indicators-inline">
        {% for indicator in result.indicators %}
            {% include "partials/projects/marco_logico_indicator.html" %}
        {% endfor %}
    </div>
    {% endif %}

    <!-- Activities -->
    <div class="ml-node-children">
        {% for activity in result.activities %}
            {% include "partials/projects/marco_logico_activity.html" %}
        {% endfor %}
    </div>
</div>
