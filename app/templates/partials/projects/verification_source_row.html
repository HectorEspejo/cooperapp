{% set _t = t if t is defined else None %}
{% set _counterpart = is_counterpart if is_counterpart is defined else false %}
<div class="source-card {% if source.validado %}validated{% endif %}">
    <div class="source-header">
        <div class="source-doc-info">
            {% if source.document.is_image %}
            <span class="source-doc-icon"><i class="fas fa-image"></i></span>
            {% elif source.document.is_pdf %}
            <span class="source-doc-icon"><i class="fas fa-file-lines"></i></span>
            {% else %}
            <span class="source-doc-icon"><i class="fas fa-paperclip"></i></span>
            {% endif %}
            <span class="source-doc-name" title="{{ source.document.original_filename }}">
                {{ source.document.original_filename|truncate(30) }}
            </span>
        </div>
        <div class="source-actions">
            <a
                {% if _counterpart %}
                href="/contraparte/{{ project_id }}/documents/{{ source.document.id }}/download"
                {% else %}
                href="/api/documents/{{ source.document.id }}/download"
                {% endif %}
                class="btn btn-icon btn-sm"
                title="{{ _t('vs.download') if _t else 'Descargar' }}"
                download
            ><i class="fas fa-download"></i></a>
            {% if not _counterpart %}
            {% if not source.validado %}
            <button
                class="btn btn-icon btn-sm btn-success"
                title="{{ _t('vs.validate_source') if _t else 'Validar fuente' }}"
                hx-post="/projects/verification-sources/{{ source.id }}/validate"
                hx-target=".verification-modal"
                hx-swap="outerHTML"
            ><i class="fas fa-check"></i></button>
            {% endif %}
            <button
                class="btn btn-icon btn-sm btn-danger"
                title="{{ _t('vs.delete_link') if _t else 'Eliminar vinculo' }}"
                hx-delete="/projects/verification-sources/{{ source.id }}"
                hx-target=".verification-modal"
                hx-swap="outerHTML"
                hx-confirm="{{ _t('vs.confirm_delete') if _t else 'Eliminar esta fuente de verificacion?' }}"
            ><i class="fas fa-xmark"></i></button>
            {% endif %}
        </div>
    </div>
    <div class="source-body">
        <div class="source-meta">
            <span class="source-tipo tipo-{{ source.tipo.value }}">
                {{ tipo_nombres[source.tipo.value] }}
            </span>
            {% if source.validado %}
            <span class="source-validated-badge" title="Validado el {{ source.fecha_validacion.strftime('%d/%m/%Y') if source.fecha_validacion else '' }}">
                <i class="fas fa-check"></i> {{ _t('vs.validated_badge') if _t else 'Validado' }}
            </span>
            {% else %}
            <span class="source-pending-badge">
                {{ _t('vs.pending_badge') if _t else 'Pendiente' }}
            </span>
            {% endif %}
        </div>
        {% if source.descripcion %}
        <p class="source-description">{{ source.descripcion }}</p>
        {% endif %}
    </div>
</div>
